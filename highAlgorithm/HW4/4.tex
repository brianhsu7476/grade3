\begin{pr}
\begin{lm}\label{4a}
If a process succeeds with probability at least $p$, where $p>0$ is a constant, and each time the process runs, the results are independent, then the expected number of times running the process to get a success is at most $\frac1p$.
\begin{proof}
Let $T$ denote the number of times running the process to get a success.\\
%Suppose that the probability that the process succeeds $=q$.\\
$\E[T]=1+\P[$ the process fails $]\E[T]\leq1+(1-p)\E[T]$.\\
$\then p\E[T]\leq1$.\\
$\then\E[T]\leq\frac1p$.
\end{proof}
\end{lm}
\begin{lm}\label{4b}
The expected time complexity of step 3 is $O(i)$.
\begin{proof}
The probability that inserting $j$ in the rebuild process fails $=$ the probability that collisions happen on both slots $\overset{\text{Both tables have at most }j\text{ non-empty slots}}\leq(\frac j{4i^{1.5}})^2\leq(\frac i{4i^{1.5}})^2=\frac1{16i}$.\\
$\then$ the probability that at least one of the above fails $\leq i\times\frac1{16i}=\frac1{16}$.\\
$\so$ the probability that the rebuild process succeeds $=1-$ the probability that at least one of the above fails $\geq\frac{15}{16}$.\\
By \rflm{4a}, the expected number of times the rebuild process is run $\leq\frac{16}{15}=O(1)$.\\
Since the rebuild process needs to insert at most $i$ items, its time complexity is $O(i)$.\\
$\so$ the expected time complexity of step 3 $=O(i)O(1)=O(i)$.
\end{proof}
\end{lm}
\begin{lm}\label{4c}
For any $i$, the expected total number of times step 3 is run when the $i$, $(i+1)$, \dots, $(2i-1)$-th insertion arrive is $O(1)$.
\begin{proof}
If step 3 is run for $0$ times, then \rflm{4c} holds clearly.\\
Suppose that step 3 is run for the first time when the $j$-th insertion arrives.\\
For all $k=j+1, j+2, \dots, 2i-1$, let $p_k$ denote the expected probability that step 3 is run when the $k$-th insertion arrives.\\
$p_k=$ the expected probability that collisions happen on both slots $\overset{\text{Both tables have at most }k\text{ non-empty slots}}\leq(\frac k{\text{table size}})^2\leq(\frac k{4j^{1.5}})^2\leq(\frac{2i}{4j^{1.5}})^2\leq(\frac{2i}{4i^{1.5}})^2=\frac1{4i}$.\\
$\so$ the expected number of step 3 is called $=1+\suml_{k=j+1}^{2i-1}p_k\leq1+\suml_{k=i}^{2i-1}p_k\leq1+\suml_{k=i}^{2i-1}\frac1{4i}=\frac54=O(1)$.
\end{proof}
\end{lm}
Let $t_i$ denote the total expected running time when the $i$, $i+1$, \dots, $2i-1$-th insertion arrive.\\
By \rflm{4c}, $t_i$ is ($O(i)$ step 1 or 2) $+$ ($O(1)$ step 3) $\overtext{By \rflm{4b}}=O(i)O(1)+O(1)O(i)=O(i)$.\\
Let $k$ be an integer such that $n\leq2^k<2n$.\\
The total expected time complexity $\leq t_1+t_2+t_4+t_8+\cdots+t_{2^k}=O(1)+O(2)+O(4)+O(8)+\cdots+O(2^k)=O(2^{k+1})=O(4n)=O(n)$.
\end{pr}
